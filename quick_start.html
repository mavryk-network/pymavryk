

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Quick start &mdash; PyMavryk  documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />

  
    <link rel="shortcut icon" href="_static/favicon.ico"/>
    <link rel="canonical" href="https://pymavryk.mavryk.org/quick_start.html" />
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=5929fcd5"></script>
      <script src="_static/doctools.js?v=9a2dae69"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Michelson integration tests" href="integration_tests.html" />
    <link rel="prev" title="Welcome to PyMavryk reference!" href="contents.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="contents.html" class="icon icon-home">
            PyMavryk
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Quick start</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="#requirements">Requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="#installation">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#set-key-and-rpc-node">Set key and RPC node</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#generate-keys">Generate keys</a></li>
<li class="toctree-l3"><a class="reference internal" href="#set-key-as-default">Set key as default</a></li>
<li class="toctree-l3"><a class="reference internal" href="#top-up-account">Top up account</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#reveal-public-key">Reveal public key</a></li>
<li class="toctree-l2"><a class="reference internal" href="#originate-contract">Originate contract</a></li>
<li class="toctree-l2"><a class="reference internal" href="#bulk-injecting">Bulk injecting</a></li>
<li class="toctree-l2"><a class="reference internal" href="#call-an-entrypoint">Call an entrypoint</a></li>
<li class="toctree-l2"><a class="reference internal" href="#access-storage">Access storage</a></li>
<li class="toctree-l2"><a class="reference internal" href="#bigmap-lookup">BigMap lookup</a></li>
<li class="toctree-l2"><a class="reference internal" href="#view-method">View method</a></li>
<li class="toctree-l2"><a class="reference internal" href="#get-contract-balance">Get Contract Balance</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="integration_tests.html">Michelson integration tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="pymavryk_cli.html">PyMavryk CLI</a></li>
<li class="toctree-l1"><a class="reference internal" href="high_level.html">High-level interfaces</a></li>
<li class="toctree-l1"><a class="reference internal" href="crypto.html">Cryptography</a></li>
<li class="toctree-l1"><a class="reference internal" href="operation_groups.html">Building and parsing operations</a></li>
<li class="toctree-l1"><a class="reference internal" href="rpc_queries.html">RPC query engine</a></li>
<li class="toctree-l1"><a class="reference internal" href="types.html">Michelson types</a></li>
<li class="toctree-l1"><a class="reference internal" href="instructions.html">Michelson instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="code.html">Working with Michelson code</a></li>
<li class="toctree-l1"><a class="reference internal" href="repl.html">Michelson REPL</a></li>
<li class="toctree-l1"><a class="reference internal" href="inspect_proposals.html">Inspecting proposals</a></li>
<li class="toctree-l1"><a class="reference internal" href="michelson_kernel.html">Michelson IPython kernel</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="contents.html">PyMavryk</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="contents.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Quick start</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/quick_start.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="quick-start">
<h1>Quick start<a class="headerlink" href="#quick-start" title="Link to this heading"></a></h1>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Link to this heading"></a></h2>
<p>PyMavryk library is a Python toolset for Mavryk blockchain, including work with keys, signatures, contracts, operations,
RPC query builder, and a high-level interface for smart contract interaction. It can be used to build a full-fledged
application, but also it’s perfect for doing researches in Jupyter interactive notebooks.
In this quick start guide, we’ll go through the main concepts and inspect one of the common use cases.</p>
</section>
<section id="requirements">
<h2>Requirements<a class="headerlink" href="#requirements" title="Link to this heading"></a></h2>
<p>Make sure you have Python 3.8+ installed and set as default in the system.</p>
<p>You also need to install cryptographic packages before installing the library/building the project:</p>
<p><em>Linux</em></p>
<p>Use apt or your favourite package manager:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ sudo apt install libsodium-dev libgmp-dev
</pre></div>
</div>
<p><em>MacOS</em></p>
<p>Use homebrew:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ brew install libsodium gmp
</pre></div>
</div>
<p><em>Windows</em></p>
<p>The recommended way is to use WSL and then follow the instructions for Linux,
but if you feel lucky you can try to install natively:</p>
<ol class="arabic simple">
<li><p>Install MinGW from <a class="reference external" href="https://osdn.net/projects/mingw/">https://osdn.net/projects/mingw/</a></p></li>
<li><p>Make sure <code class="docutils literal notranslate"><span class="pre">C:\MinGW\bin</span></code> is added to your <code class="docutils literal notranslate"><span class="pre">PATH</span></code></p></li>
<li><p>Download the latest libsodium-X.Y.Z-msvc.zip from <a class="reference external" href="https://download.libsodium.org/libsodium/releases/">https://download.libsodium.org/libsodium/releases/</a>.</p></li>
<li><p>Extract the Win64/Release/v143/dynamic/libsodium.dll from the zip file</p></li>
<li><p>Copy libsodium.dll to C:WindowsSystem32libsodium.dll</p></li>
</ol>
</section>
<section id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Link to this heading"></a></h2>
<p>In console:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ pip install pymavryk
</pre></div>
</div>
<p>In Google Colab notebook:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="err">!</span><span class="n">apt</span> <span class="n">install</span> <span class="n">libsodium</span><span class="o">-</span><span class="n">dev</span> <span class="n">libgmp</span><span class="o">-</span><span class="n">dev</span>
<span class="gp">&gt;&gt;&gt; </span><span class="err">!</span><span class="n">pip</span> <span class="n">install</span> <span class="n">pymavryk</span>
<span class="go">[RESTART RUNTIME]</span>
</pre></div>
</div>
<p>That’s it! You can open Python console or Jupyter notebook and get to the next step.</p>
</section>
<section id="set-key-and-rpc-node">
<h2>Set key and RPC node<a class="headerlink" href="#set-key-and-rpc-node" title="Link to this heading"></a></h2>
<p>All active interaction with the blockchain starts with the PyMavrykClient:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">pymavryk</span><span class="w"> </span><span class="kn">import</span> <span class="n">pymavryk</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pymavryk</span>
<span class="go">&lt;pymavryk.client.PyMavrykClient object at 0x7f95b0c9e5b0&gt;</span>

<span class="go"> Properties</span>
<span class="go"> .key                mv1VDuhoWLjBMmeM1iTS4g4aapw1Zwkz9ziU</span>
<span class="go"> .shell              [&#39;https://basenet.rpc.mavryk.network&#39;]</span>
<span class="go"> .block_id   head</span>

<span class="go"> Helpers</span>
<span class="go"> .account()</span>
<span class="go"> .activate_account()</span>
<span class="go"> .activate_protocol()</span>
<span class="go"> .bake_block()</span>
<span class="go"> .balance()</span>
<span class="go"> .ballot()</span>
<span class="go"> .bulk()</span>
<span class="go"> .check_message()</span>
<span class="go"> .contract()</span>
<span class="go"> .delegation()</span>
<span class="go"> .double_baking_evidence()</span>
<span class="go"> .double_endorsement_evidence()</span>
<span class="go"> .endorsement()</span>
<span class="go"> .endorsement_with_slot()</span>
<span class="go"> .failing_noop()</span>
<span class="go"> .now()</span>
<span class="go"> .operation()</span>
<span class="go"> .operation_group()</span>
<span class="go"> .origination()</span>
<span class="go"> .proposals()</span>
<span class="go"> .register_global_constant()</span>
<span class="go"> .reveal()</span>
<span class="go"> .seed_nonce_revelation()</span>
<span class="go"> .sign_message()</span>
<span class="go"> .sleep()</span>
<span class="go"> .transaction()</span>
<span class="go"> .using()</span>
<span class="go"> .wait()</span>
</pre></div>
</div>
<p>This is one of the cool features in the interactive mode: aside from the autocomplete and call docstrings,
you can see the list of available methods for class, or list of arguments and return value for a particular methods.
We are interested in <code class="docutils literal notranslate"><span class="pre">using</span></code> method, which is responsible for setting up manager key and RPC connection.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pymavryk</span><span class="o">.</span><span class="n">using</span>
<span class="go">&lt;function PyMavrykClient.using at 0x7f958be02ee0&gt;</span>
<span class="go"> Change current RPC endpoint and account (private key).</span>

<span class="go"> :param shell: one of &#39;mainnet&#39;, &#39;***net&#39;, or RPC node uri, or instance of :class:`pymavryk.rpc.shell.ShellQuery`</span>
<span class="go"> :param key: base58 encoded key, path to the faucet file, faucet file itself, alias from mavkit-client, or `Key`</span>
<span class="go"> :param mode: whether to use `readable` or `optimized` encoding for parameters/storage/other</span>
<span class="go"> :returns: A copy of current object with changes applied</span>
</pre></div>
</div>
<p>Note, that by default <code class="docutils literal notranslate"><span class="pre">pymavryk</span></code> is initialized with the latest testnet and a predefined private key for demo purpose,
so you can start to interact immediately, but it’s highly recommended to use your own key. Let’s do that!</p>
<section id="generate-keys">
<h3>Generate keys<a class="headerlink" href="#generate-keys" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">pymavryk</span><span class="w"> </span><span class="kn">import</span> <span class="n">Key</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">key</span> <span class="o">=</span> <span class="n">Key</span><span class="o">.</span><span class="n">generate</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">key</span>
<span class="go">&lt;pymavryk.crypto.key.Key object at 0x7f958bd3b7f0&gt;</span>

<span class="go">Public key hash</span>
<span class="go">mv1MGgJxyRyNK8vAiE6oCdazu3yZobxuZYNo</span>

<span class="go">Helpers</span>
<span class="go">.blinded_public_key_hash()</span>
<span class="go">.from_alias()</span>
<span class="go">.from_encoded_key()</span>
<span class="go">.from_faucet()</span>
<span class="go">.from_mnemonic()</span>
<span class="go">.from_public_point()</span>
<span class="go">.from_secret_exponent()</span>
<span class="go">.generate()</span>
<span class="go">.public_key()</span>
<span class="go">.public_key_hash()</span>
<span class="go">.secret_key()</span>
<span class="go">.sign()</span>
<span class="go">.verify()</span>
</pre></div>
</div>
</section>
<section id="set-key-as-default">
<h3>Set key as default<a class="headerlink" href="#set-key-as-default" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pymavryk</span> <span class="o">=</span> <span class="n">pymavryk</span><span class="o">.</span><span class="n">using</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pymavryk</span>
<span class="go">&lt;pymavryk.client.PyMavrykClient object at 0x7f958b64f190&gt;</span>

<span class="go">Properties</span>
<span class="go">.key                mv1Ue5qMgJFNFKkjF9x7z867ciE8imnKX8V3</span>
<span class="go">.shell              [&#39;https://basenet.rpc.mavryk.network&#39;]</span>
<span class="go">.block_id   head</span>

<span class="go">Helpers</span>
<span class="go">.account()</span>
<span class="go">.activate_account()</span>
<span class="go">.activate_protocol()</span>
<span class="go">.bake_block()</span>
<span class="go">.balance()</span>
<span class="go">.ballot()</span>
<span class="go">.bulk()</span>
<span class="go">.check_message()</span>
<span class="go">.contract()</span>
<span class="go">.delegation()</span>
<span class="go">.double_baking_evidence()</span>
<span class="go">.double_endorsement_evidence()</span>
<span class="go">.endorsement()</span>
<span class="go">.endorsement_with_slot()</span>
<span class="go">.failing_noop()</span>
<span class="go">.now()</span>
<span class="go">.operation()</span>
<span class="go">.operation_group()</span>
<span class="go">.origination()</span>
<span class="go">.proposals()</span>
<span class="go">.register_global_constant()</span>
<span class="go">.reveal()</span>
<span class="go">.seed_nonce_revelation()</span>
<span class="go">.sign_message()</span>
<span class="go">.sleep()</span>
<span class="go">.transaction()</span>
<span class="go">.using()</span>
<span class="go">.wait()</span>
</pre></div>
</div>
</section>
<section id="top-up-account">
<h3>Top up account<a class="headerlink" href="#top-up-account" title="Link to this heading"></a></h3>
<p>Go to the <cite>https://basenet.faucet.mavryk.network/ &lt;https://basenet.faucet.mavryk.network/&gt;</cite> and paste your public key hash key file to the “Wallet address” field.
Press “Request 2001 mav” and wait for transaction to be completed.</p>
<p>Check that your balance is non-zero:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pymavryk</span><span class="o">.</span><span class="n">account</span><span class="p">()</span>
<span class="go">{&#39;balance&#39;: &#39;2001000000&#39;, &#39;counter&#39;: &#39;1&#39;}</span>
</pre></div>
</div>
<p>What happened is your account has been allocated by an incoming transaction and its balance is now positive.</p>
</section>
</section>
<section id="reveal-public-key">
<h2>Reveal public key<a class="headerlink" href="#reveal-public-key" title="Link to this heading"></a></h2>
<p>Now, in order to start using this key we need to send the according public key to the chain so that bakers can validate operation signatures.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">reveal_op</span> <span class="o">=</span> <span class="n">pymavryk</span><span class="o">.</span><span class="n">reveal</span><span class="p">()</span><span class="o">.</span><span class="n">send</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">reveal_op</span>
<span class="go">&lt;pymavryk.operation.group.OperationGroup object at 0x7f95d73ff3d0&gt;</span>

<span class="go"> Properties</span>
<span class="go"> .key                mv1Ue5qMgJFNFKkjF9x7z867ciE8imnKX8V3</span>
<span class="go"> .shell              [&#39;https://basenet.rpc.mavryk.network&#39;]</span>
<span class="go"> .block_id   head</span>

<span class="go"> Hash</span>
<span class="go"> oo6e7UjGkvoqXG49VRNuN5cEAjo5TqyiRJtVhTvXETbYDDahDNR</span>

<span class="go"> Payload</span>
<span class="go"> {&#39;branch&#39;: &#39;BMCwRayudxVKJs68pAGEebhUJAtj6VRHGadkFsau8T7mbCjUXKp&#39;,</span>
<span class="go"> &#39;contents&#39;: [{&#39;counter&#39;: &#39;15404826&#39;,</span>
<span class="go">             &#39;fee&#39;: &#39;370&#39;,</span>
<span class="go">             &#39;gas_limit&#39;: &#39;1000&#39;,</span>
<span class="go">             &#39;kind&#39;: &#39;reveal&#39;,</span>
<span class="go">             &#39;public_key&#39;: &#39;edpkvHehVYEFJss7VxieJydkdbAwbSNqV9hN4SHo2P6WtsceZ24eaj&#39;,</span>
<span class="go">             &#39;source&#39;: &#39;mv1Ue5qMgJFNFKkjF9x7z867ciE8imnKX8V3&#39;,</span>
<span class="go">             &#39;storage_limit&#39;: &#39;0&#39;}],</span>
<span class="go"> &#39;protocol&#39;: &#39;PtLimaPtLMwfNinJi9rCfDPWea8dFgTZ1MeJ9f1m2SRic6ayiwW&#39;,</span>
<span class="go"> &#39;signature&#39;: &#39;sigPcdMpWx48qsCyotSaHg3RYskNq6RWD2cJT2Nno53yUiJBpTAkGNuMnPvNc17iDqM994TNqckGm85Dxv3C6smKaKYnf7xp&#39;}</span>

<span class="go"> Helpers</span>
<span class="go"> .activate_account()</span>
<span class="go"> .autofill()</span>
<span class="go"> .ballot()</span>
<span class="go"> .binary_payload()</span>
<span class="go"> .delegation()</span>
<span class="go"> .double_baking_evidence()</span>
<span class="go"> .double_endorsement_evidence()</span>
<span class="go"> .endorsement()</span>
<span class="go"> .endorsement_with_slot()</span>
<span class="go"> .failing_noop()</span>
<span class="go"> .fill()</span>
<span class="go"> .forge()</span>
<span class="go"> .hash()</span>
<span class="go"> .inject()</span>
<span class="go"> .json_payload()</span>
<span class="go"> .message()</span>
<span class="go"> .operation()</span>
<span class="go"> .origination()</span>
<span class="go"> .preapply()</span>
<span class="go"> .proposals()</span>
<span class="go"> .register_global_constant()</span>
<span class="go"> .result()</span>
<span class="go"> .reveal()</span>
<span class="go"> .run()</span>
<span class="go"> .run_operation()</span>
<span class="go"> .seed_nonce_revelation()</span>
<span class="go"> .send()</span>
<span class="go"> .send_async()</span>
<span class="go"> .sign()</span>
<span class="go"> .transaction()</span>
</pre></div>
</div>
<p>We can also search for operation by hash if we know exact block level or that it was injected recently:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pymavryk</span><span class="o">.</span><span class="n">shell</span><span class="o">.</span><span class="n">blocks</span><span class="p">[</span><span class="o">-</span><span class="mi">20</span><span class="p">:]</span><span class="o">.</span><span class="n">find_operation</span><span class="p">(</span><span class="n">reveal_op</span><span class="o">.</span><span class="n">opg_hash</span><span class="p">)</span>
<span class="go">{&#39;protocol&#39;: &#39;PtLimaPtLMwfNinJi9rCfDPWea8dFgTZ1MeJ9f1m2SRic6ayiwW&#39;,</span>
<span class="go"> &#39;chain_id&#39;: &#39;NetXnHfVqm9iesp&#39;,</span>
<span class="go"> &#39;hash&#39;: &#39;oo6e7UjGkvoqXG49VRNuN5cEAjo5TqyiRJtVhTvXETbYDDahDNR&#39;,</span>
<span class="go"> &#39;branch&#39;: &#39;BLvDnmxUXwLMB3UyREj8ckLDdSBgzajyxZJfmoCrifZXhaRaHAL&#39;,</span>
<span class="go"> &#39;contents&#39;: [{&#39;kind&#39;: &#39;reveal&#39;,</span>
<span class="go"> &#39;source&#39;: &#39;mv1Ue5qMgJFNFKkjF9x7z867ciE8imnKX8V3&#39;,</span>
<span class="go"> &#39;fee&#39;: &#39;370&#39;,</span>
<span class="go"> &#39;counter&#39;: &#39;15404829&#39;,</span>
<span class="go"> &#39;gas_limit&#39;: &#39;1000&#39;,</span>
<span class="go"> &#39;storage_limit&#39;: &#39;0&#39;,</span>
<span class="go"> &#39;public_key&#39;: &#39;edpkvHehVYEFJss7VxieJydkdbAwbSNqV9hN4SHo2P6WtsceZ24eaj&#39;,</span>
<span class="go"> &#39;metadata&#39;: {&#39;balance_updates&#39;: [{&#39;kind&#39;: &#39;contract&#39;,</span>
<span class="go">     &#39;contract&#39;: &#39;mv1Ue5qMgJFNFKkjF9x7z867ciE8imnKX8V3&#39;,</span>
<span class="go">     &#39;change&#39;: &#39;-370&#39;,</span>
<span class="go">     &#39;origin&#39;: &#39;block&#39;},</span>
<span class="go">     {&#39;kind&#39;: &#39;accumulator&#39;,</span>
<span class="go">     &#39;category&#39;: &#39;block fees&#39;,</span>
<span class="go">     &#39;change&#39;: &#39;370&#39;,</span>
<span class="go">     &#39;origin&#39;: &#39;block&#39;}],</span>
<span class="go">     &#39;operation_result&#39;: {&#39;status&#39;: &#39;applied&#39;,</span>
<span class="go">     &#39;consumed_milligas&#39;: &#39;1000000&#39;}}}],</span>
<span class="go"> &#39;signature&#39;: &#39;siggMmepBSUQuavD2ws99CQtt4jRapf5HDiJM3Um26n619Y1ojCcRhxoLampysAMZZDEqVdbUXqGUXLpHzDRaTdRdCZD4p5W&#39;}</span>
</pre></div>
</div>
</section>
<section id="originate-contract">
<h2>Originate contract<a class="headerlink" href="#originate-contract" title="Link to this heading"></a></h2>
<p>Now we can do something interesting. Let’s deploy a Michelson smart contract! First we need to load data, in this
tutorial we will get it from Michelson source file. There are plenty of available methods, but we’are interested in
<code class="docutils literal notranslate"><span class="pre">script</span></code> which gives us payload for origination.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">pymavryk</span><span class="w"> </span><span class="kn">import</span> <span class="n">ContractInterface</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">contract</span> <span class="o">=</span> <span class="n">ContractInterface</span><span class="o">.</span><span class="n">from_url</span><span class="p">(</span><span class="s1">&#39;https://raw.githubusercontent.com/baking-bad/pymavryk/master/tests/unit_tests/test_michelson/test_repl/mini_scenarios/ticket_wallet_fungible.tz&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">contract</span><span class="o">.</span><span class="n">script</span>
<span class="go">&lt;function ContractInterface.script at 0x7fc1768e2c10&gt;</span>
<span class="go">Generate script for contract origination.</span>

<span class="go">:param initial_storage: Python object, leave None to generate default (attach shell/key for smart fill)</span>
<span class="go">:param mode: whether to use `readable` or `optimized` (or `legacy_optimized`) encoding for initial storage</span>
<span class="go">:return: {&quot;code&quot;: $Micheline, &quot;storage&quot;: $Micheline}</span>
</pre></div>
</div>
<p>PyMavryk can generate empty storage based on the type description, moreover it can do smart filling with the context provided (network, key).
Let’s attach shell and key to the contract interface and see the default storage generated:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ci</span> <span class="o">=</span> <span class="n">contract</span><span class="o">.</span><span class="n">using</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">)</span>
<span class="gp">... </span><span class="n">ci</span><span class="o">.</span><span class="n">storage</span><span class="o">.</span><span class="n">dummy</span><span class="p">()</span>
<span class="go">{&#39;manager&#39;: &#39;mv1Ue5qMgJFNFKkjF9x7z867ciE8imnKX8V3&#39;, &#39;tickets&#39;: {}}</span>
</pre></div>
</div>
<p>Perfect! Now we are ready to deploy the contract:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pymavryk</span><span class="o">.</span><span class="n">origination</span><span class="p">(</span><span class="n">script</span><span class="o">=</span><span class="n">ci</span><span class="o">.</span><span class="n">script</span><span class="p">())</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">min_confirmations</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="go">{ ... origination operation body ... }</span>
</pre></div>
</div>
<p>Note that we used synchronous injection this time, PyMavryk does all the polling job for you and freezes the execution until operations is included into a block.
Previously we were searching operation using an integer offset (N levels ago), here’s another example how to search an operation using branch:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">pymavryk.operation.result</span><span class="w"> </span><span class="kn">import</span> <span class="n">OperationResult</span>
<span class="gp">... </span><span class="n">opg</span> <span class="o">=</span> <span class="n">pymavryk</span><span class="o">.</span><span class="n">shell</span><span class="o">.</span><span class="n">blocks</span><span class="p">[</span><span class="s1">&#39;BM8tcfVyd1g8yqqfE8UpasXZWFLS3Xr3cRyYaoKTTfhU9PUr1YR&#39;</span><span class="p">:]</span> \
<span class="gp">... </span>    <span class="o">.</span><span class="n">find_operation</span><span class="p">(</span><span class="s1">&#39;ooKx4wBV4DerrXnAEMRfZrwTyBZQQgBMGGD3xbyXeffWn88QC1f&#39;</span><span class="p">)</span>
<span class="gp">... </span><span class="n">res</span> <span class="o">=</span> <span class="n">OperationResult</span><span class="o">.</span><span class="n">from_operation_group</span><span class="p">(</span><span class="n">opg</span><span class="p">)</span>
<span class="gp">... </span><span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">originated_contracts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="go">&#39;KT1VtPT2CKekZnQvyR44tTNyWCKrmHdxxYBw&#39;</span>
</pre></div>
</div>
</section>
<section id="bulk-injecting">
<h2>Bulk injecting<a class="headerlink" href="#bulk-injecting" title="Link to this heading"></a></h2>
<p>The example we chose is actually a ticket wallet that can only send or receive existing tickets, so we need another contract capable of minting new ones.
Simultaneously, we will explore how to batch several operations in a single group.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">wallet</span> <span class="o">=</span> <span class="n">ContractInterface</span> \
<span class="gp">... </span>    <span class="o">.</span><span class="n">from_url</span><span class="p">(</span><span class="s1">&#39;https://raw.githubusercontent.com/baking-bad/pymavryk/master/tests/unit_tests/test_michelson/test_repl/mini_scenarios/ticket_wallet_fungible.tz&#39;</span><span class="p">)</span> \
<span class="gp">... </span>    <span class="o">.</span><span class="n">using</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">... </span><span class="n">builder</span> <span class="o">=</span> <span class="n">ContractInterface</span> \
<span class="gp">... </span>    <span class="o">.</span><span class="n">from_url</span><span class="p">(</span><span class="s1">&#39;https://raw.githubusercontent.com/baking-bad/pymavryk/master/tests/unit_tests/test_michelson/test_repl/mini_scenarios/ticket_builder_fungible.tz&#39;</span><span class="p">)</span> \
<span class="gp">... </span>    <span class="o">.</span><span class="n">using</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">... </span><span class="n">opg</span> <span class="o">=</span> <span class="n">pymavryk</span><span class="o">.</span><span class="n">bulk</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">wallet</span><span class="o">.</span><span class="n">originate</span><span class="p">(),</span>
<span class="gp">... </span>    <span class="n">builder</span><span class="o">.</span><span class="n">originate</span><span class="p">()</span>
<span class="gp">... </span><span class="p">)</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">min_confirmations</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">... </span><span class="p">[</span><span class="n">res</span><span class="o">.</span><span class="n">originated_contracts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="n">OperationResult</span><span class="o">.</span><span class="n">from_operation_group</span><span class="p">(</span><span class="n">opg</span><span class="o">.</span><span class="n">opg_result</span><span class="p">)]</span>
<span class="go">[&#39;KT1S4UmLNwVcmLBE9VgHKpJJWpKE1JE8VjwN&#39;, &#39;KT1Si4t6ETLoj6eEsjp8hvfJeiFe3b6Z7eM5&#39;]</span>
</pre></div>
</div>
</section>
<section id="call-an-entrypoint">
<h2>Call an entrypoint<a class="headerlink" href="#call-an-entrypoint" title="Link to this heading"></a></h2>
<p>We have our contracts deployed and ready to be invoked, let’s see the list of entrypoints available and their signatures:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">builder</span> <span class="o">=</span> <span class="n">pymavryk</span><span class="o">.</span><span class="n">contract</span><span class="p">(</span><span class="s1">&#39;KT1Si4t6ETLoj6eEsjp8hvfJeiFe3b6Z7eM5&#39;</span><span class="p">)</span>
<span class="gp">... </span><span class="n">builder</span><span class="o">.</span><span class="n">parameter</span>
<span class="go"> &lt;pymavryk.contract.entrypoint.ContractEntrypoint object at 0x7f95d57f54c0&gt;</span>

<span class="go"> Properties</span>
<span class="go"> .key                mv1Ue5qMgJFNFKkjF9x7z867ciE8imnKX8V3</span>
<span class="go"> .shell              [&#39;https://basenet.rpc.mavryk.network&#39;]</span>
<span class="go"> .address    KT1Si4t6ETLoj6eEsjp8hvfJeiFe3b6Z7eM5</span>
<span class="go"> .block_id   head</span>
<span class="go"> .entrypoint default</span>

<span class="go"> Builtin</span>
<span class="go"> (*args, **kwargs)   # build transaction parameters (see typedef)</span>

<span class="go"> Typedef</span>
<span class="go"> $default:</span>
<span class="go">     { &quot;burn&quot;: ticket (unit) } ||</span>
<span class="go">     { &quot;mint&quot;: $mint }</span>

<span class="go"> $mint:</span>
<span class="go">     {</span>
<span class="go">     &quot;destination&quot;: contract ($destination_param),</span>
<span class="go">     &quot;amount&quot;: nat</span>
<span class="go">     }</span>

<span class="go"> $destination_param:</span>
<span class="go">     ticket unit</span>

<span class="go"> $ticket:</span>
<span class="go">     /* no literal form, tickets can only be created by another contract */</span>

<span class="go"> $contract:</span>
<span class="go">     str  /* Base58 encoded `KT` address with optional entrypoint */ ||</span>
<span class="go">     None  /* when you need to avoid type checking */ ||</span>
<span class="go">     Undefined  /* `from pymavryk import Undefined` for resolving None ambiguity  */</span>

<span class="go"> $nat:</span>
<span class="go">     int  /* Natural number */</span>


<span class="go"> Helpers</span>
<span class="go"> .decode()</span>
<span class="go"> .encode()</span>
</pre></div>
</div>
<p>And for the wallet:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">wallet</span> <span class="o">=</span> <span class="n">pymavryk</span><span class="o">.</span><span class="n">contract</span><span class="p">(</span><span class="s1">&#39;KT1S4UmLNwVcmLBE9VgHKpJJWpKE1JE8VjwN&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">wallet</span><span class="o">.</span><span class="n">parameter</span>
<span class="go">&lt;pymavryk.contract.entrypoint.ContractEntrypoint object at 0x7f95d57f5fd0&gt;</span>

<span class="go">Properties</span>
<span class="go">.key                mv1Ue5qMgJFNFKkjF9x7z867ciE8imnKX8V3</span>
<span class="go">.shell              [&#39;https://basenet.rpc.mavryk.network&#39;]</span>
<span class="go">.address    KT1S4UmLNwVcmLBE9VgHKpJJWpKE1JE8VjwN</span>
<span class="go">.block_id   head</span>
<span class="go">.entrypoint default</span>

<span class="go">Builtin</span>
<span class="go">(*args, **kwargs)   # build transaction parameters (see typedef)</span>

<span class="go">Typedef</span>
<span class="go">$default:</span>
<span class="go">    { &quot;receive&quot;: ticket (unit) } ||</span>
<span class="go">    { &quot;send&quot;: $send }</span>

<span class="go">$send:</span>
<span class="go">    {</span>
<span class="go">    &quot;destination&quot;: contract ($destination_param),</span>
<span class="go">    &quot;amount&quot;: nat,</span>
<span class="go">    &quot;ticketer&quot;: address</span>
<span class="go">    }</span>

<span class="go">$destination_param:</span>
<span class="go">    ticket unit</span>

<span class="go">$ticket:</span>
<span class="go">    /* no literal form, tickets can only be created by another contract */</span>

<span class="go">$contract:</span>
<span class="go">    str  /* Base58 encoded `KT` address with optional entrypoint */ ||</span>
<span class="go">    None  /* when you need to avoid type checking */ ||</span>
<span class="go">    Undefined  /* `from pymavryk import Undefined` for resolving None ambiguity  */</span>

<span class="go">$nat:</span>
<span class="go">    int  /* Natural number */</span>

<span class="go">$address:</span>
<span class="go">    str  /* Base58 encoded `mv` or `KT` address */</span>


<span class="go">Helpers</span>
<span class="go">.decode()</span>
<span class="go">.encode()</span>
</pre></div>
</div>
<p>Seems that we can mint a ticket using our builder and specify our wallet as a destination.
Let’s also use bulk API again to demonstrate how to batch contract calls:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">opg</span> <span class="o">=</span> <span class="n">pymavryk</span><span class="o">.</span><span class="n">bulk</span><span class="p">(</span>
<span class="gp">... </span>   <span class="n">builder</span><span class="o">.</span><span class="n">mint</span><span class="p">(</span><span class="n">destination</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">wallet</span><span class="o">.</span><span class="n">address</span><span class="si">}</span><span class="s1">%receive&#39;</span><span class="p">,</span> <span class="n">amount</span><span class="o">=</span><span class="mi">42</span><span class="p">),</span>
<span class="gp">... </span>   <span class="n">builder</span><span class="o">.</span><span class="n">mint</span><span class="p">(</span><span class="n">destination</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">wallet</span><span class="o">.</span><span class="n">address</span><span class="si">}</span><span class="s1">%receive&#39;</span><span class="p">,</span> <span class="n">amount</span><span class="o">=</span><span class="mi">123</span><span class="p">)</span>
<span class="gp">... </span><span class="p">)</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">min_confirmations</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">wallet</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;tickets&#39;</span><span class="p">][</span><span class="n">builder</span><span class="o">.</span><span class="n">address</span><span class="p">]()</span>
<span class="go">(&#39;KT1Si4t6ETLoj6eEsjp8hvfJeiFe3b6Z7eM5&#39;, Unit, 165)</span>
</pre></div>
</div>
<p>Success!</p>
</section>
<section id="access-storage">
<h2>Access storage<a class="headerlink" href="#access-storage" title="Link to this heading"></a></h2>
<p>We have slightly touched storage access in the previous section, now let’s play with <a class="reference external" href="https://better-call.dev/mainnet/KT1REEb5VxWRjcHm5GzDMwErMmNFftsE5Gpf/operations">KT1REEb5VxWRjcHm5GzDMwErMmNFftsE5Gpf</a>
as it has BigMap entries, named entrypoints, and a non-trivial data scheme.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">usds</span> <span class="o">=</span> <span class="n">pymavryk</span><span class="o">.</span><span class="n">using</span><span class="p">(</span><span class="s1">&#39;mainnet&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">contract</span><span class="p">(</span><span class="s1">&#39;KT1REEb5VxWRjcHm5GzDMwErMmNFftsE5Gpf&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">usds</span>
<span class="go"> &lt;pymavryk.jupyter.ContractInterface object at 0x7fc17689f2b0&gt;</span>

<span class="go"> Properties</span>
<span class="go"> .key  # mv1LDPE2n2mZXbQt3MwR5ZbQU432eag71grX</span>
<span class="go"> .shell  # https://rpc.mavryk.network/ (mainnet)</span>
<span class="go"> .address  # KT1REEb5VxWRjcHm5GzDMwErMmNFftsE5Gpf</span>
<span class="go"> .block_id  # head</span>
<span class="go"> .storage  # access storage data at block `block_id`</span>
<span class="go"> .parameter  # root entrypoint</span>

<span class="go"> Entrypoints</span>
<span class="go"> .accept_ownership()</span>
<span class="go"> .burn()</span>
<span class="go"> .call_FA2()</span>
<span class="go"> .balance_of()</span>
<span class="go"> .transfer()</span>
<span class="go"> .update_operators()</span>
<span class="go"> .change_master_minter()</span>
<span class="go"> .change_pauser()</span>
<span class="go"> .configure_minter()</span>
<span class="go"> .mint()</span>
<span class="go"> .pause()</span>
<span class="go"> .permit()</span>
<span class="go"> .remove_minter()</span>
<span class="go"> .set_expiry()</span>
<span class="go"> .set_transferlist()</span>
<span class="go"> .transfer_ownership()</span>
<span class="go"> .unpause()</span>
<span class="go"> .default()</span>

<span class="go"> Helpers</span>
<span class="go"> .big_map_get()</span>
<span class="go"> .create_from()</span>
<span class="go"> .from_context()</span>
<span class="go"> .from_file()</span>
<span class="go"> .from_micheline()</span>
<span class="go"> .from_michelson()</span>
<span class="go"> .operation_result()</span>
<span class="go"> .originate()</span>
<span class="go"> .program()</span>
<span class="go"> .script()</span>
<span class="go"> .to_file()</span>
<span class="go"> .to_micheline()</span>
<span class="go"> .to_michelson()</span>
<span class="go"> .using()</span>
</pre></div>
</div>
<p>You can access contract storage at any block level, just pass block id into the <code class="docutils literal notranslate"><span class="pre">using</span></code> method:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">usds</span><span class="o">.</span><span class="n">using</span><span class="p">(</span><span class="n">block_id</span><span class="o">=</span><span class="s1">&#39;head~10&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">storage</span><span class="p">()</span>
<span class="go"> {&#39;default_expiry&#39;: 300000,</span>
<span class="go">  &#39;ledger&#39;: -1,</span>
<span class="go">  &#39;metadata&#39;: -2,</span>
<span class="go">  &#39;minting_allowances&#39;: {&#39;mv1N913itbcFVECQPzKLzXfgN8jgZ6MaEPwE&#39;: 999989000000,</span>
<span class="go">   &#39;mv19bzdiWWzVhwLHCCbPjeyLjiUMgdKAxsbF&#39;: 999985800000},</span>
<span class="go">  &#39;operators&#39;: -3,</span>
<span class="go">  &#39;paused&#39;: False,</span>
<span class="go">  &#39;permit_counter&#39;: 0,</span>
<span class="go">  &#39;permits&#39;: -4,</span>
<span class="go">  &#39;roles&#39;: {&#39;master_minter&#39;: &#39;mv19bzdiWWzVhwLHCCbPjeyLjiUMgdKAxsbF&#39;,</span>
<span class="go">   &#39;owner&#39;: &#39;mv19bzdiWWzVhwLHCCbPjeyLjiUMgdKAxsbF&#39;,</span>
<span class="go">   &#39;pauser&#39;: &#39;mv19bzdiWWzVhwLHCCbPjeyLjiUMgdKAxsbF&#39;,</span>
<span class="go">   &#39;pending_owner&#39;: None},</span>
<span class="go">  &#39;total_supply&#39;: 20200000,</span>
<span class="go">  &#39;transferlist_contract&#39;: None}</span>
</pre></div>
</div>
<p>Under the hood PyMavryk has parsed the storage type, collapsed all nested structures, converted annotations into keys,
and in the result we get a simple Python object which is much easier to manipulate.
You can also access child elements by name or index (depending on the underlying Michelson type).
In order to see type definition, just remove the trailing brackets:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">usds</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;ledger&#39;</span><span class="p">]</span>
<span class="go"> &lt;pymavryk.contract.data.ContractData object at 0x7f21aaeaca30&gt;</span>

<span class="go"> Properties</span>
<span class="go"> .key  # mv1LDPE2n2mZXbQt3MwR5ZbQU432eag71grX</span>
<span class="go"> .shell  # https://rpc.mavryk.network/ (mainnet)</span>
<span class="go"> .address  # KT1REEb5VxWRjcHm5GzDMwErMmNFftsE5Gpf</span>
<span class="go"> .block_id  # head</span>
<span class="go"> .path  # /ledger</span>

<span class="go"> Builtin</span>
<span class="go"> ()  # get as Python object</span>
<span class="go"> [key]  # access child elements by name or index</span>

<span class="go"> Typedef</span>
<span class="go"> $ledger:</span>
<span class="go">     { address: nat, … } || int /* Big_map ID */</span>

<span class="go"> $address:</span>
<span class="go">     str  /* Base58 encoded `mv` or `KT` address */</span>

<span class="go"> $nat:</span>
<span class="go">     int  /* Natural number */</span>


<span class="go"> Helpers</span>
<span class="go"> .decode()</span>
<span class="go"> .dummy()</span>
<span class="go"> .encode()</span>
<span class="go"> .to_micheline()</span>
<span class="go"> .to_michelson()</span>
</pre></div>
</div>
</section>
<section id="bigmap-lookup">
<h2>BigMap lookup<a class="headerlink" href="#bigmap-lookup" title="Link to this heading"></a></h2>
<p>The approach described in the previous section also works for lazy storage, here’s how you can access Big_map values:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">usds</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;ledger&#39;</span><span class="p">][</span><span class="s1">&#39;mv1N913itbcFVECQPzKLzXfgN8jgZ6MaEPwE&#39;</span><span class="p">]()</span>
<span class="go">11000000</span>
</pre></div>
</div>
<p>Pretty cool, hah?</p>
</section>
<section id="view-method">
<h2>View method<a class="headerlink" href="#view-method" title="Link to this heading"></a></h2>
<p>In the previous example we queried a token balance for a particular owner.
We can do the same using special entrypoint <code class="docutils literal notranslate"><span class="pre">balance_of</span></code>. Let’s give a look at the interface:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">usds</span><span class="o">.</span><span class="n">balance_of</span>
<span class="go"> &lt;pymavryk.contract.entrypoint.ContractEntrypoint object at 0x7f4789170dc0&gt;</span>

<span class="go"> Properties</span>
<span class="go"> .key  # mv1LDPE2n2mZXbQt3MwR5ZbQU432eag71grX</span>
<span class="go"> .shell  # https://rpc.mavryk.network/ (mainnet)</span>
<span class="go"> .address  # KT1REEb5VxWRjcHm5GzDMwErMmNFftsE5Gpf</span>
<span class="go"> .block_id  # head</span>
<span class="go"> .entrypoint  # balance_of</span>

<span class="go"> Builtin</span>
<span class="go"> (*args, **kwargs)  # build transaction parameters (see typedef)</span>

<span class="go"> Typedef</span>
<span class="go"> $balance_of:</span>
<span class="go">     {</span>
<span class="go">       &quot;requests&quot;: [ $requests_item, … ],</span>
<span class="go">       &quot;callback&quot;: contract ($callback_param)</span>
<span class="go">     }</span>

<span class="go"> $callback_param:</span>
<span class="go">     list (pair (pair %request (address %owner) (nat %token_id)) (nat %balance))</span>

<span class="go"> $requests_item:</span>
<span class="go">     {</span>
<span class="go">       &quot;owner&quot;: address,</span>
<span class="go">       &quot;token_id&quot;: nat</span>
<span class="go">     }</span>

<span class="go"> $address:</span>
<span class="go">     str  /* Base58 encoded `mv` or `KT` address */</span>

<span class="go"> $nat:</span>
<span class="go">     int  /* Natural number */</span>


<span class="go"> Helpers</span>
<span class="go"> .decode()</span>
<span class="go"> .encode()</span>
</pre></div>
</div>
<p>Apparently, we need to pass a list of requests, where each item contains owner address and token ID.
In addition to that a callback address is expected which should accept the response (currently there are no on-chain views in Mavryk, this async pattern is a workaround for them).
PyMavryk allows you to keep that address empty and get the view result:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">usds</span><span class="o">.</span><span class="n">balance_of</span><span class="p">(</span><span class="n">requests</span><span class="o">=</span><span class="p">[</span>
<span class="gp">... </span>  <span class="p">{</span><span class="s1">&#39;owner&#39;</span><span class="p">:</span> <span class="s1">&#39;mv1N913itbcFVECQPzKLzXfgN8jgZ6MaEPwE&#39;</span><span class="p">,</span> <span class="s1">&#39;token_id&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
<span class="gp">... </span>  <span class="p">{</span><span class="s1">&#39;owner&#39;</span><span class="p">:</span> <span class="s1">&#39;mv19bzdiWWzVhwLHCCbPjeyLjiUMgdKAxsbF&#39;</span><span class="p">,</span> <span class="s1">&#39;token_id&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
<span class="gp">... </span>  <span class="p">{</span><span class="s1">&#39;owner&#39;</span><span class="p">:</span> <span class="s1">&#39;mv2e9VsSX7VxigA4Z9eqMiEtQZdvnS7Go4j4&#39;</span><span class="p">,</span> <span class="s1">&#39;token_id&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
<span class="go">...], callback=None).view()</span>
<span class="go">[{&#39;owner&#39;: &#39;mv1N913itbcFVECQPzKLzXfgN8jgZ6MaEPwE&#39;,</span>
<span class="go">  &#39;token_id&#39;: 0,</span>
<span class="go">  &#39;nat_2&#39;: 11000000},</span>
<span class="go"> {&#39;owner&#39;: &#39;mv19bzdiWWzVhwLHCCbPjeyLjiUMgdKAxsbF&#39;,</span>
<span class="go">  &#39;token_id&#39;: 0,</span>
<span class="go">  &#39;nat_2&#39;: 8200000},</span>
<span class="go"> {&#39;owner&#39;: &#39;mv2e9VsSX7VxigA4Z9eqMiEtQZdvnS7Go4j4&#39;, &#39;token_id&#39;: 0, &#39;nat_2&#39;: 0}]</span>
</pre></div>
</div>
</section>
<section id="get-contract-balance">
<h2>Get Contract Balance<a class="headerlink" href="#get-contract-balance" title="Link to this heading"></a></h2>
<p>Looking for a balance for a contract involves interacting with the contract context. You can inspect the context object to see the methods, or read about it here - <a class="reference internal" href="repl.html#pymavryk.context.impl.ExecutionContext" title="pymavryk.context.impl.ExecutionContext"><code class="xref py py-class docutils literal notranslate"><span class="pre">pymavryk.context.impl.ExecutionContext</span></code></a></p>
<p>The context object holds general functions for retriving data about a contract/address, including the <cite>get_balance()</cite> call.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">kolibri_oven</span> <span class="o">=</span> <span class="n">pymavryk</span><span class="o">.</span><span class="n">using</span><span class="p">(</span><span class="s1">&#39;mainnet&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">contract</span><span class="p">(</span><span class="s1">&#39;KT1KH3wH4sneEevPVW7AACiVKMjhTvmXLSK6&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">([</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">kolibri_oven</span><span class="o">.</span><span class="n">context</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;get_&#39;</span><span class="p">)])</span>
<span class="go">[&#39;get_amount&#39;, &#39;get_amount_expr&#39;, &#39;get_balance&#39;, &#39;get_balance_expr&#39;, &#39;get_big_map_diff&#39;, &#39;get_big_map_value&#39;, &#39;get_big_maps_expr&#39;, &#39;get_chain_id&#39;, &#39;get_chain_id_expr&#39;, &#39;get_code_expr&#39;, &#39;get_counter&#39;, &#39;get_counter_offset&#39;, &#39;get_dummy_address&#39;, &#39;get_dummy_chain_id&#39;, &#39;get_dummy_key_hash&#39;, &#39;get_dummy_lambda&#39;, &#39;get_dummy_public_key&#39;, &#39;get_dummy_signature&#39;, &#39;get_input_expr&#39;, &#39;get_level&#39;, &#39;get_now&#39;, &#39;get_now_expr&#39;, &#39;get_operations_ttl&#39;, &#39;get_originated_address&#39;, &#39;get_output_expr&#39;, &#39;get_parameter_expr&#39;, &#39;get_sapling_state_diff&#39;, &#39;get_self_address&#39;, &#39;get_self_expr&#39;, &#39;get_sender&#39;, &#39;get_sender_expr&#39;, &#39;get_source&#39;, &#39;get_source_expr&#39;, &#39;get_storage_expr&#39;, &#39;get_tmp_big_map_id&#39;, &#39;get_tmp_sapling_state_id&#39;, &#39;get_total_voting_power&#39;, &#39;get_voting_power&#39;]</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">kolibri_oven_balance</span> <span class="o">=</span> <span class="n">kolibri_oven</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">get_balance</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Kolibri oven </span><span class="si">{}</span><span class="s2"> has MVRK balance </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">kolibri_oven</span><span class="o">.</span><span class="n">address</span><span class="p">,</span> <span class="n">kolibri_oven_balance</span> <span class="o">/</span> <span class="mf">1e6</span><span class="p">))</span>
<span class="go">Kolibri oven KT1KH3wH4sneEevPVW7AACiVKMjhTvmXLSK6 has MVRK balance 191.869689</span>
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="contents.html" class="btn btn-neutral float-left" title="Welcome to PyMavryk reference!" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="integration_tests.html" class="btn btn-neutral float-right" title="Michelson integration tests" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020, Baking Bad.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>